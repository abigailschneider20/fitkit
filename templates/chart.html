{% extends 'base.html' %}

{% block body %}

<h2 class="form-signin-heading">Your FitBit Data</h2>
     <br><br>
<div>
<ul> 
<form action = "/chart" id = "chartdata" name = "chartdata"> Select what type of data you would like to chart: <br>
  <input type = "checkbox" class = "chart" name = "chart_type" value = "PHQ9"> PHQ9 Scores <br>
  <input type = "checkbox" class = "chart" name = "chart_type" value = "GAD7"> GAD7 Scores <br>
  <input type ="checkbox" class = "chart" name = "chart_type" value = "Insomnia Index"> Sleep Questionnaire Scores <br>
  <input type = "checkbox" class = "chart" name = "chart_type" value = "Resting Heart Rate"> Heart Rate <br>
  <input type = "checkbox" class = "chart" name = "chart_type" value = "Steps"> Steps <br>
  <input type = "checkbox" class = "chart" name = "chart_type" value = "Mins Slept"> Minutes Slept <br>
  <input type = "checkbox" class = "chart" name = "chart_type" value = "Mins Exercise"> Minutes of Exercise <br>
  <input type = "checkbox" class = "chart" name = "chart_type" value = "Mins Sedentary"> Sedentary Minutes <br>
     <button type="submit">Submit 
        </button>
  </form>

  Insert Chart here:
  <div class = 'lineChart'>
  <canvas id='lineChart'></canvas>
  <div id='lineLegend'></div>
</div>

<script>

  // Make line graph of data currently available
  // Get input out of a form element with jQuery
  let ctx = $('#lineChart').get(0).getContext('2d');

  const options = {
    responsive: true,
    scales: {
      xAxes: [{stacked:true}],
      yAxes: [{
        ticks: {
          beginAtZero:true
        },
        stacked:false
      }]
    }
  };

  const formInputs = {
    'chart_type':$("input:checkbox[name='chart_type']:checked", "#chartdata").val()
  };
  console.log(formInputs);

  $('#chartdata').submit( (evt)=> {
    evt.preventDefault();
     const formInputs = {
      'chart_type':$("input:checkbox[name='chart_type']:checked", "#chartdata").val()
    };
    $.get('/chartdata.json', formInputs, (data)=> {
      console.log(data);
      let myLineChart = Chart.Line(ctx, {
                            data: data,
                            options: options
                        });
    });
  }); 

  $.get('/chartdata.json', formInputs, (data)=> {
    console.log(data);
    let myLineChart = Chart.Line(ctx, {
                            data: data,
                            options: options
                        });
  });


  //   $('#lineLegend').html(myLineChart.generateLegend());
  // });

</script>

<footer>
    <div>
                  <form action = "/logout" method = "POST"> 
                  <input type = "submit" value = "Log Out"> <!--    Show only when user is logged in using JS -->
                 </form>
            </div>
        </footer>

</ul>
</div>
  <span><h3> <form action = '/getfit' method = 'GET'> <a href = '/getfit'> Access more FitBit data</a></form> </h3>
  <h3> <form action = '/newtest' method = 'GET'> <a href = '/newtest'> Take a new mental health test</a></form> </h3> 
  <h3> <form action = '/chart' method = 'GET'><a href = '/chart'> View Chart </a></form></h3>
  <h3><form action = '/ehrtemplate' method = 'GET'><a href = '/ehrtemplate'> Convert Data to EHR Template </a></span>
{% endblock %}


  

